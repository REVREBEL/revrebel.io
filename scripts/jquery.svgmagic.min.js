(function($){$.fn.svgmagic=function(givenOptions){var defaultOptions={preloader:!1,testmode:!1,secure:!1,callback:!1,backgroundimage:!1,dumpcache:!1,temporaryHoldingImage:null,forceReplacements:!1,handleBackgroundImages:!1,additionalRequestData:{},postReplacementCallback:null,remoteServerUri:"http://bitlabs.nl/svgmagic/converter/3/",remoteRequestType:"POST",remoteDataType:"jsonp",debug:!1,replacementUriCreator:null},untidyOptions=$.extend(defaultOptions,givenOptions),options=tidyOptions(untidyOptions),holdingImageTimeouts={},matchedNodes=this,images=[],imgElementName="img",srcAttributeName="src",backgroundImagePropertyName="background-image",urlMatcher=/^url\(["']?([^"'()]+)["']?\)$/,svgExtension=/\.svg$/,svgDataUri=/^data:image\/svg\+xml/,holdingImageTimeoutDuration=500,VERSION=3;function shouldPerformReplacement(e){return e.forceReplacements||!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image","1.1")}function buildImageList(e,t){var r=[];return t.each((function(){var t,n,a=$(this);a.attr(srcAttributeName)&&((n=buildImageReference(a.attr(srcAttributeName),a,!1))&&(r.push(n),e.temporaryHoldingImage&&(t=setTimeout((function(){a.attr(srcAttributeName,e.temporaryHoldingImage)}),holdingImageTimeoutDuration),holdingImageTimeouts[r.length-1]=t)));e.handleBackgroundImages&&a.css(backgroundImagePropertyName)&&"none"!=a.css(backgroundImagePropertyName)&&((n=buildImageReference(urlMatcher.exec(a.css(backgroundImagePropertyName))[1],a,!0))&&r.push(n))})),log(!1,["Builded image list",r]),r}function buildImageReference(e,t,r){var n=null;if(svgExtension.test(e)||svgDataUri.test(e)){var a=new Image;a.src=e,n={element:t,isBackground:r,originalUri:a.src,replacementUri:null}}return n}function getReplacementUris(e,t){var r=e.replacementUriCreator;if((images=buildImageList(e,t)).length>0)if(r&&"function"==typeof r){for(var n=0;n<images.length;n++){var a=images[n];a.replacementUri=r(a.element,a.originalUri,a.isBackground)}performReplacements(e)}else getReplacementUrisFromRemoteService(e)}function getReplacementUrisFromRemoteService(e){for(var t=[],r={},n=0;n<images.length;n++)t.push(images[n].originalUri);var a=window.location.href.split("/");$.extend(r,e.additionalRequestData,{svgsources:t,version:VERSION,origin:a[2]}),$.ajax({dataType:e.remoteDataType,method:e.remoteRequestType,url:e.remoteServerUri,data:r,timeout:3e3,success:function(t,r,n){for(var a=0;a<images.length;a++){var o=images[a],i=t.images[a].image;o.replacementUri=i,o.error=t.images[a].error,o.responseMsg=t.images[a].msg,o.filename=t.images[a].filename}performReplacements(e)},error:function(){log(!0,"The request took longer than 3 seconds to complete. No image were replaced. Use the developer tools to check wheter the server responded with an error.")}})}function performReplacements(e){for(var t=0;t<images.length;t++){var r=images[t],n=r.replacementUri;n?r.error?log(!0,r.filename+": "+r.responseMsg):r.isBackground?(log(!1,r.filename+": Background image replaced. Server responded with: "+r.responseMsg),r.element.css(backgroundImagePropertyName,'url("'+n+'")')):(log(!1,r.filename+": Image replaced. Server responded with: "+r.responseMsg),e.temporaryHoldingImage&&clearTimeout(holdingImageTimeouts[t]),r.element.attr(srcAttributeName,n)):log(!0,r.filename+": No new url received")}e.postReplacementCallback&&"function"==typeof e.postReplacementCallback&&e.postReplacementCallback(images)}function tidyOptions(e){return!e.temporaryHoldingImage&&e.preloader&&"string"==typeof e.preloader&&(e.temporaryHoldingImage=e.preloader),e.testmode&&"boolean"==typeof e.testmode&&(e.forceReplacements=!0),!e.postReplacementCallback&&e.callback&&"function"==typeof e.callback&&(e.postReplacementCallback=function(t){e.callback()}),e.additionalRequestData.secure||(e.additionalRequestData.secure=e.secure),e.additionalRequestData.dumpcache||(e.additionalRequestData.dumpcache=e.dumpcache),e}function log(e,t){options.debug}return("https:"==window.location.protocol||options.additionalRequestData.secure)&&(options.remoteServerUri=options.remoteServerUri.replace("http://","https://")),log(!1,"Using "+options.remoteServerUri+" as remote server"),shouldPerformReplacement(options)&&getReplacementUris(options,matchedNodes),"undefined"==typeof JSON&&("object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,(function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}))+'"':'"'+e+'"'}function str(e,t){var r,n,a,o,i,s=gap,l=t[e];switch(l&&"object"==typeof l&&"function"==typeof l.toJSON&&(l=l.toJSON(e)),"function"==typeof rep&&(l=rep.call(t,e,l)),typeof l){case"string":return quote(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";if(gap+=indent,i=[],"[object Array]"===Object.prototype.toString.apply(l)){for(o=l.length,r=0;r<o;r+=1)i[r]=str(r,l)||"null";return a=0===i.length?"[]":gap?"[\n"+gap+i.join(",\n"+gap)+"\n"+s+"]":"["+i.join(",")+"]",gap=s,a}if(rep&&"object"==typeof rep)for(o=rep.length,r=0;r<o;r+=1)"string"==typeof rep[r]&&(a=str(n=rep[r],l))&&i.push(quote(n)+(gap?": ":":")+a);else for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(a=str(n,l))&&i.push(quote(n)+(gap?": ":":")+a);return a=0===i.length?"{}":gap?"{\n"+gap+i.join(",\n"+gap)+"\n"+s+"}":"{"+i.join(",")+"}",gap=s,a}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b"," ":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,r){var n;if(gap="",indent="","number"==typeof r)for(n=0;n<r;n+=1)indent+=" ";else"string"==typeof r&&(indent=r);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var r,n,a=e[t];if(a&&"object"==typeof a)for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(void 0!==(n=walk(a,r))?a[r]=n:delete a[r]);return reviver.call(e,t,a)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,(function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}))),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}()),this}})(jQuery);